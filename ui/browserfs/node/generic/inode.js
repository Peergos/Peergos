"use strict";
var node_fs_stats_1 = require('../core/node_fs_stats');
var Inode = (function () {
    function Inode(id, size, mode, atime, mtime, ctime) {
        this.id = id;
        this.size = size;
        this.mode = mode;
        this.atime = atime;
        this.mtime = mtime;
        this.ctime = ctime;
    }
    Inode.prototype.toStats = function () {
        return new node_fs_stats_1["default"]((this.mode & 0xF000) === node_fs_stats_1.FileType.DIRECTORY ? node_fs_stats_1.FileType.DIRECTORY : node_fs_stats_1.FileType.FILE, this.size, this.mode, new Date(this.atime), new Date(this.mtime), new Date(this.ctime));
    };
    Inode.prototype.getSize = function () {
        return 30 + this.id.length;
    };
    Inode.prototype.toBuffer = function (buff) {
        if (buff === void 0) { buff = new Buffer(this.getSize()); }
        buff.writeUInt32LE(this.size, 0);
        buff.writeUInt16LE(this.mode, 4);
        buff.writeDoubleLE(this.atime, 6);
        buff.writeDoubleLE(this.mtime, 14);
        buff.writeDoubleLE(this.ctime, 22);
        buff.write(this.id, 30, this.id.length, 'ascii');
        return buff;
    };
    Inode.prototype.update = function (stats) {
        var hasChanged = false;
        if (this.size !== stats.size) {
            this.size = stats.size;
            hasChanged = true;
        }
        if (this.mode !== stats.mode) {
            this.mode = stats.mode;
            hasChanged = true;
        }
        var atimeMs = stats.atime.getTime();
        if (this.atime !== atimeMs) {
            this.atime = atimeMs;
            hasChanged = true;
        }
        var mtimeMs = stats.mtime.getTime();
        if (this.mtime !== mtimeMs) {
            this.mtime = mtimeMs;
            hasChanged = true;
        }
        var ctimeMs = stats.ctime.getTime();
        if (this.ctime !== ctimeMs) {
            this.ctime = ctimeMs;
            hasChanged = true;
        }
        return hasChanged;
    };
    Inode.fromBuffer = function (buffer) {
        if (buffer === undefined) {
            throw new Error("NO");
        }
        return new Inode(buffer.toString('ascii', 30), buffer.readUInt32LE(0), buffer.readUInt16LE(4), buffer.readDoubleLE(6), buffer.readDoubleLE(14), buffer.readDoubleLE(22));
    };
    Inode.prototype.isFile = function () {
        return (this.mode & 0xF000) === node_fs_stats_1.FileType.FILE;
    };
    Inode.prototype.isDirectory = function () {
        return (this.mode & 0xF000) === node_fs_stats_1.FileType.DIRECTORY;
    };
    return Inode;
}());
module.exports = Inode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5vZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZ2VuZXJpYy9pbm9kZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEJBQXlDLHVCQUF1QixDQUFDLENBQUE7QUFLakU7SUFDRSxlQUFtQixFQUFVLEVBQ3BCLElBQVksRUFDWixJQUFZLEVBQ1osS0FBYSxFQUNiLEtBQWEsRUFDYixLQUFhO1FBTEgsT0FBRSxHQUFGLEVBQUUsQ0FBUTtRQUNwQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ1osU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNaLFVBQUssR0FBTCxLQUFLLENBQVE7UUFDYixVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQ2IsVUFBSyxHQUFMLEtBQUssQ0FBUTtJQUFJLENBQUM7SUFLcEIsdUJBQU8sR0FBZDtRQUNFLE1BQU0sQ0FBQyxJQUFJLDBCQUFLLENBQ2QsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLHdCQUFRLENBQUMsU0FBUyxHQUFHLHdCQUFRLENBQUMsU0FBUyxHQUFHLHdCQUFRLENBQUMsSUFBSSxFQUNoRixJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM1RixDQUFDO0lBS00sdUJBQU8sR0FBZDtRQUVFLE1BQU0sQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDN0IsQ0FBQztJQUtNLHdCQUFRLEdBQWYsVUFBZ0IsSUFBNkM7UUFBN0Msb0JBQTZDLEdBQTdDLFdBQXVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDM0QsSUFBSSxDQUFDLGFBQWEsQ0FB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QUFiO1FBQ0UsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyx3QkFBUSxDQUFDLElBQUksQ0FBQztJQUNoRCxDQUFDO0lBS00sMkJBQVcsR0FBbEI7UUFDRSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLHdCQUFRLENBQUMsU0FBUyxDQUFDO0lBQ3JELENBQUM7SUFDSCxZQUFDO0FBQUQsQ0FBQyxBQWpIRCxJQWlIQztBQUVELGlCQUFTLEtBQUssQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZGVmYXVsdCBhcyBTdGF0cywgRmlsZVR5cGV9IGZyb20gJy4uL2NvcmUvbm9kZV9mc19zdGF0cyc7XHJcblxyXG4vKipcclxuICogR2VuZXJpYyBpbm9kZSBkZWZpbml0aW9uIHRoYXQgY2FuIGVhc2lseSBiZSBzZXJpYWxpemVkLlxyXG4gKi9cclxuY2xhc3MgSW5vZGUge1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpZDogc3RyaW5nLFxyXG4gICAgcHVibGljIHNpemU6IG51bWJlcixcclxuICAgIHB1YmxpYyBtb2RlOiBudW1iZXIsXHJcbiAgICBwdWJsaWMgYXRpbWU6IG51bWJlcixcclxuICAgIHB1YmxpYyBtdGltZTogbnVtYmVyLFxyXG4gICAgcHVibGljIGN0aW1lOiBudW1iZXIpIHsgfVxyXG5cclxuICAvKipcclxuICAgKiBIYW5keSBmdW5jdGlvbiB0aGF0IGNvbnZlcnRzIHRoZSBJbm9kZSB0byBhIE5vZGUgU3RhdHMgb2JqZWN0LlxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b1N0YXRzKCk6IFN0YXRzIHtcclxuICAgIHJldHVybiBuZXcgU3RhdHMoXHJcbiAgICAgICh0aGlzLm1vZGUgJiAweEYwMDApID09PSBGaWxlVHlwZS5ESVJFQ1RPUlkgPyBGaWxlVHlwZS5ESVJFQ1RPUlkgOiBGaWxlVHlwZS5GSUxFLFxyXG4gICAgICB0aGlzLnNpemUsIHRoaXMubW9kZSwgbmV3IERhdGUodGhpcy5hdGltZSksIG5ldyBEYXRlKHRoaXMubXRpbWUpLCBuZXcgRGF0ZSh0aGlzLmN0aW1lKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIHNpemUgb2YgdGhpcyBJbm9kZSwgaW4gYnl0ZXMuXHJcbiAgICovXHJcbiAgcHVibGljIGdldFNpemUoKTogbnVtYmVyIHtcclxuICAgIC8vIEFTU1VNUFRJT046IElEIGlzIEFTQ0lJICgxIGJ5dGUgcGVyIGNoYXIpLlxyXG4gICAgcmV0dXJuIDMwICsgdGhpcy5pZC5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBXcml0ZXMgdGhlIGlub2RlIGludG8gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIuXHJcbiAgICovXHJcbiAgcHVibGljIHRvQnVmZmVyKGJ1ZmY6IE5vZGVCdWZmZXIgPSBuZXcgQnVmZmVyKHRoaXMuZ2V0U2l6ZSgpKSk6IE5vZGVCdWZmZXIge1xyXG4gICAgYnVmZi53cml0ZVVJbnQzMkxFKHRoaXMuc2l6ZSwgMCk7XHJcbiAgICBidWZmLndyaXRlVUludDE2TEUodGhpcy5tb2RlLCA0KTtcclxuICAgIGJ1ZmYud3JpdGVEb3VibGVMRSh0aGlzLmF0aW1lLCA2KTtcclxuICAgIGJ1ZmYud3JpdGVEb3VibGVMRSh0aGlzLm10aW1lLCAxNCk7XHJcbiAgICBidWZmLndyaXRlRG91YmxlTEUodGhpcy5jdGltZSwgMjIpO1xyXG4gICAgYnVmZi53cml0ZSh0aGlzLmlkLCAzMCwgdGhpcy5pZC5sZW5ndGgsICdhc2NpaScpO1xyXG4gICAgcmV0dXJuIGJ1ZmY7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGVzIHRoZSBJbm9kZSB1c2luZyBpbmZvcm1hdGlvbiBmcm9tIHRoZSBzdGF0cyBvYmplY3QuIFVzZWQgYnkgZmlsZVxyXG4gICAqIHN5c3RlbXMgYXQgc3luYyB0aW1lLCBlLmcuOlxyXG4gICAqIC0gUHJvZ3JhbSBvcGVucyBmaWxlIGFuZCBnZXRzIGEgRmlsZSBvYmplY3QuXHJcbiAgICogLSBQcm9ncmFtIG11dGF0ZXMgZmlsZS4gRmlsZSBvYmplY3QgaXMgcmVzcG9uc2libGUgZm9yIG1haW50YWluaW5nXHJcbiAgICogICBtZXRhZGF0YSBjaGFuZ2VzIGxvY2FsbHkgLS0gdHlwaWNhbGx5IGluIGEgU3RhdHMgb2JqZWN0LlxyXG4gICAqIC0gUHJvZ3JhbSBjbG9zZXMgZmlsZS4gRmlsZSBvYmplY3QncyBtZXRhZGF0YSBjaGFuZ2VzIGFyZSBzeW5jZWQgd2l0aCB0aGVcclxuICAgKiAgIGZpbGUgc3lzdGVtLlxyXG4gICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgY2hhbmdlcyBoYXZlIG9jY3VycmVkLlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGUoc3RhdHM6IFN0YXRzKTogYm9vbGVhbiB7XHJcbiAgICB2YXIgaGFzQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgaWYgKHRoaXMuc2l6ZSAhPT0gc3RhdHMuc2l6ZSkge1xyXG4gICAgICB0aGlzLnNpemUgPSBzdGF0cy5zaXplO1xyXG4gICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5tb2RlICE9PSBzdGF0cy5tb2RlKSB7XHJcbiAgICAgIHRoaXMubW9kZSA9IHN0YXRzLm1vZGU7XHJcbiAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBhdGltZU1zID0gc3RhdHMuYXRpbWUuZ2V0VGltZSgpO1xyXG4gICAgaWYgKHRoaXMuYXRpbWUgIT09IGF0aW1lTXMpIHtcclxuICAgICAgdGhpcy5hdGltZSA9IGF0aW1lTXM7XHJcbiAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBtdGltZU1zID0gc3RhdHMubXRpbWUuZ2V0VGltZSgpO1xyXG4gICAgaWYgKHRoaXMubXRpbWUgIT09IG10aW1lTXMpIHtcclxuICAgICAgdGhpcy5tdGltZSA9IG10aW1lTXM7XHJcbiAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBjdGltZU1zID0gc3RhdHMuY3RpbWUuZ2V0VGltZSgpO1xyXG4gICAgaWYgKHRoaXMuY3RpbWUgIT09IGN0aW1lTXMpIHtcclxuICAgICAgdGhpcy5jdGltZSA9IGN0aW1lTXM7XHJcbiAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBoYXNDaGFuZ2VkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29udmVydHMgdGhlIGJ1ZmZlciBpbnRvIGFuIElub2RlLlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUJ1ZmZlcihidWZmZXI6IE5vZGVCdWZmZXIpOiBJbm9kZSB7XHJcbiAgICBpZiAoYnVmZmVyID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTk9cIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IElub2RlKGJ1ZmZlci50b1N0cmluZygnYXNjaWknLCAzMCksXHJcbiAgICAgIGJ1ZmZlci5yZWFkVUludDMyTEUoMCksXHJcbiAgICAgIGJ1ZmZlci5yZWFkVUludDE2TEUoNCksXHJcbiAgICAgIGJ1ZmZlci5yZWFkRG91YmxlTEUoNiksXHJcbiAgICAgIGJ1ZmZlci5yZWFkRG91YmxlTEUoMTQpLFxyXG4gICAgICBidWZmZXIucmVhZERvdWJsZUxFKDIyKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vIFhYWDogQ29waWVkIGZyb20gU3RhdHMuIFNob3VsZCByZWNvbmNpbGUgdGhlc2UgdHdvIGludG8gc29tZXRoaW5nIG1vcmVcclxuICAvLyAgICAgIGNvbXBhY3QuXHJcblxyXG4gIC8qKlxyXG4gICAqIEByZXR1cm4gW0Jvb2xlYW5dIFRydWUgaWYgdGhpcyBpdGVtIGlzIGEgZmlsZS5cclxuICAgKi9cclxuICBwdWJsaWMgaXNGaWxlKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICh0aGlzLm1vZGUgJiAweEYwMDApID09PSBGaWxlVHlwZS5GSUxFO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHJldHVybiBbQm9vbGVhbl0gVHJ1ZSBpZiB0aGlzIGl0ZW0gaXMgYSBkaXJlY3RvcnkuXHJcbiAgICovXHJcbiAgcHVibGljIGlzRGlyZWN0b3J5KCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICh0aGlzLm1vZGUgJiAweEYwMDApID09PSBGaWxlVHlwZS5ESVJFQ1RPUlk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgPSBJbm9kZTtcclxuIl19